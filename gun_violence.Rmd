---
title: "Gun Violence Visualizations"
author: "Erin Guetzloe"
date: "11/18/2019"
output: html_document
---

```{r setup, include=FALSE, cache=TRUE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(readxl)
library(janitor)
library(plotly)

a <- read_xlsx("raw-data/gun-violence-data_01-2013_03-2018.xlsx")

b <- read_xlsx("raw-data/firearm_restrictions_by_state.xlsx")

c <- read_xlsx("raw-data/firearm_restrictions.xlsx")

join <- full_join(a, b)

join2 <- full_join(join, c)

```

```{r plot 1}

mapping <- a %>%
  mutate(year = format(as.Date(a$date, format = "%Y-%M-%d"), "%Y")) %>%
  mutate(n_victims = n_killed + n_injured) %>%
  filter(state == "Massachusetts") %>%
  filter(city_or_county %in% c("Allston", "Arlington", "Boston", "Brighton", "Brookline", "Cambridge", "Cambridge (Cambridgeport)", "Charlestown", "Dorchester", "Dorchester Center", "Hyde Park", "Malden", "Mattapan", "Medford", "Roslindale", "Roxbury", "Somerville", "South Boston", "Watertown", "West Roxbury")) %>%
  filter(year != 2018) %>%
  select(year, n_victims)

saveRDS(object = mapping, file = "gun-violence-visualizations/Map1.rds")

plot1 <- ggplot(mapping, aes(x = year, y = n_victims)) +
  geom_col() +
  labs(x = "Year", y = "Number of Victims", title = "Gun Violence in Boston and the Greater Boston Area", caption = "2018 data not included because it only extends from January through March of 2018.")

ggplotly(plot1)

```

```{r plot 2}

mapping2 <- a %>%
  mutate(year = format(as.Date(a$date, format = "%Y-%M-%d"), "%Y")) %>%
  filter(state == "Massachusetts") %>%
  filter(city_or_county %in% c("Allston", "Arlington", "Boston", "Brighton", "Brookline", "Cambridge", "Cambridge (Cambridgeport)", "Charlestown", "Dorchester", "Dorchester Center", "Hyde Park", "Malden", "Mattapan", "Medford", "Roslindale", "Roxbury", "Somerville", "South Boston", "Watertown", "West Roxbury")) %>%
  filter(year != 2018) %>%
  select(year, n_injured)

plot2 <- ggplot(mapping2, aes(x = year, y = n_injured)) +
  geom_col() +
  labs(x = "Year", y = "Number of Victims Injured", title = "Gun-related Injuries in Boston and the Greater Boston Area")

ggplotly(plot2)

```

```{r}

#regression <- glm(n_victims ~ lawtotal)

```

